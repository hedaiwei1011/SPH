{"ast":null,"code":"//配置路由的地方\nimport Vue from 'vue';\nimport VueRouter from 'vue-router';\nimport routes from './routes';\n//引入store\nimport store from '@/store';\n//作为插件\nVue.use(VueRouter);\n\n//先把VueRouter原型对象的push 先保存一份\nlet originPush = VueRouter.prototype.push;\nlet originReplace = VueRouter.prototype.replace;\n\n//重写push｜replace\nVueRouter.prototype.push = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originPush.call(this, location, resolve, reject);\n  } else {\n    originPush.call(this, location, () => {}, () => {});\n  }\n};\nVueRouter.prototype.replace = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originReplace.call(this, location, resolve, reject);\n  } else {\n    originReplace.call(this, location, () => {}, () => {});\n  }\n};\n\n//配置路由\nlet router = new VueRouter({\n  //配置路由\n  routes,\n  scrollBehavior(to, from, savedPosition) {\n    // return 期望滚动到哪个的位置\n    //代表滚动条在最上方\n    return {\n      y: 0\n    };\n  }\n});\n\n//全局守卫 前置守卫 在路由跳转之间进行判断\nrouter.beforeEach(async (to, from, next) => {\n  //to 可以获取到你要跳到哪的信息\n  //from 获取到你从哪个路由而来的信息\n  //next 放行函数\n  //next()\n  //用户登录了，才会有token，未登录一定不会有token\n  let token = store.state.user.token;\n  let name = store.state.user.userInfo.name;\n  if (token) {\n    //用户已经登录了还想去login\n    if (to.path == '/login' || to.path == '/register') {\n      next('/home');\n    } else {\n      //登陆了去的不是login\n      //如果用户名已有\n      if (name) {\n        next();\n      } else {\n        //登陆了 但没用户信息\n        //没有用户信息 派发action让仓库存储用户信息再跳转\n        try {\n          await store.dispatch('getUserInfo');\n          next();\n        } catch (error) {\n          //token失效  获取不到用户信息，重新登陆\n          //清除token\n          await store.dispatch('userLogout');\n          next('/login');\n        }\n      }\n    }\n  } else {\n    //未登录 不能去交易相关的\n    let toPath = to.path;\n    if (toPath.indexOf('/trade') != -1 || toPath.indexOf('/pay') != -1 || toPath.indexOf('/center') != -1) {\n      next('/login');\n    } else {\n      next();\n    }\n  }\n});\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","routes","store","use","originPush","prototype","push","originReplace","replace","location","resolve","reject","call","router","scrollBehavior","to","from","savedPosition","y","beforeEach","next","token","state","user","name","userInfo","path","dispatch","error","toPath","indexOf"],"sources":["/Users/hedaiwei/Desktop/project-SPH/app/src/router/index.js"],"sourcesContent":["//配置路由的地方\nimport Vue from 'vue'\nimport VueRouter from 'vue-router'\nimport routes from './routes'\n//引入store\nimport store from '@/store'\n//作为插件\nVue.use(VueRouter)\n\n//先把VueRouter原型对象的push 先保存一份\nlet originPush = VueRouter.prototype.push\nlet originReplace = VueRouter.prototype.replace\n\n//重写push｜replace\nVueRouter.prototype.push = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originPush.call(this, location, resolve, reject)\n  } else {\n    originPush.call(\n      this,\n      location,\n      () => {},\n      () => {}\n    )\n  }\n}\nVueRouter.prototype.replace = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originReplace.call(this, location, resolve, reject)\n  } else {\n    originReplace.call(\n      this,\n      location,\n      () => {},\n      () => {}\n    )\n  }\n}\n\n//配置路由\nlet router = new VueRouter({\n  //配置路由\n  routes,\n  scrollBehavior(to, from, savedPosition) {\n    // return 期望滚动到哪个的位置\n    //代表滚动条在最上方\n    return { y: 0 }\n  },\n})\n\n//全局守卫 前置守卫 在路由跳转之间进行判断\nrouter.beforeEach(async (to, from, next) => {\n  //to 可以获取到你要跳到哪的信息\n  //from 获取到你从哪个路由而来的信息\n  //next 放行函数\n  //next()\n  //用户登录了，才会有token，未登录一定不会有token\n  let token = store.state.user.token\n  let name = store.state.user.userInfo.name\n  if (token) {\n    //用户已经登录了还想去login\n    if (to.path == '/login' || to.path == '/register') {\n      next('/home')\n    } else {\n      //登陆了去的不是login\n      //如果用户名已有\n      if (name) {\n        next()\n      } else {\n        //登陆了 但没用户信息\n        //没有用户信息 派发action让仓库存储用户信息再跳转\n        try {\n          await store.dispatch('getUserInfo')\n          next()\n        } catch (error) {\n          //token失效  获取不到用户信息，重新登陆\n          //清除token\n          await store.dispatch('userLogout')\n          next('/login')\n        }\n      }\n    }\n  } else {\n    //未登录 不能去交易相关的\n    let toPath = to.path\n    if (\n      toPath.indexOf('/trade') != -1 ||\n      toPath.indexOf('/pay') != -1 ||\n      toPath.indexOf('/center') != -1\n    ) {\n      next('/login')\n    } else {\n      next()\n    }\n  }\n})\n\nexport default router\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}